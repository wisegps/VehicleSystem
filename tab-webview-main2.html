<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/style.css" />
		<link href="css/iconfont.css" rel="stylesheet" />
		<style>
			html,
			body {
				background: url('ui/back2.png') no-repeat fixed top;
				background-color: #080808;
				background-size:100%;
			}
			header {
				box-sizing: content-box;
				background-color: #b01526!important;
				background: url('ui/navbar.png') no-repeat fixed top!important;
				background-size:100%!important;
				border-bottom: 0px solid rgba(247, 247, 247, 0)!important;
			}
			#title {
				color:white!important;
			}
			.mui-popover {
				height: 100px;
				width: 150px;
			}
			
			.mui-content{
				background: none;
			}
			#topPopover {
				position: fixed;
				top: 16px;
				right: 6px;
				font-size: 14px;
			}
			#topPopover .mui-popover-arrow {
				left: auto;
				right: 6px;
			}
			.arrow {
				padding-top: 10px;
				color: #fff;
			}
			.mui-tab-item .mui-badge {
				margin-left: -5px!important;
			    padding: 4px 4px!important;
			    border-radius: 50%;
			}
			
			.mui-bar-tab {
				text-align: center;
				height: 74px;
			}

			.mui-bar-tab .mui-tab-item.mui-active {
			    color: #F00000;
			}
			
			.mui-bar-tab .mui-tab-item {
			    /*color: #BEDFEF;*/
			}
			
			.mui-bar {
				background-color: transparent;
				background-color: #080808;
				background: url('ui/tabbar2.png') no-repeat;
				background-size:100%;				
			    -webkit-box-shadow: 0 0 0px rgba(0,0,0,.85); 
			    box-shadow: 0 0 0px rgba(0,0,0,.85); 
			    
			     
			    line-height: 50px;
			}
			
			.mui-bar-nav .mui-badge {
			    margin-left: -22px!important;
			    /* padding: 4px 4px!important; */
			    /* border-radius: 50%; */
			    margin-top: 7px;
			}
			
			#alertBadge, #notifyBadge {
				display: none;
			}
			
			#tabbar {
				width: 85%;
				vertical-align: middle;
			}
			
			.tabbar-label {
				position: absolute;
				vertical-align: middle;
				color: #fff;
				font-size: 11px;
				margin-top: 4px;
			}
			
			.tabbar-label.control {
				margin-left: -77%;
			}
			
			.tabbar-label.flameout {
				margin-left: -52%;
			}
			
			.tabbar-label.more {
				margin-left: -22%;
			}
			
			
			.mui-car-info{
				/*margin-top: 44px;*/
			}
			
			.status1 {
				padding-top: 18px;
				padding-left: 20px;
				padding-right: 19px;
				color: #fff;
				text-align: center;
				font-size: 12px;
			}
			
			.light {
				height: 20px;
				vertical-align: middle;
				padding-bottom: 4px;
			}
			
			.battery {
			    height: 20px;
			    padding-right: 35px;
			}
			
			#battery {
			    position: absolute;
			    margin-top: -5px;
			    margin-left: -30px;
			    color: #fff;
			}
			
			
			.title-add{
				
				line-height: 40px; 
				margin: 0 auto;
				z-index: 999;
				display: inline-block; 
				width: 60%;
				font-weight: 700; 
				font-size: 16px; 
				text-overflow: ellipsis; 
				white-space: nowrap; 
				overflow: hidden;
			}
			
			.status2 {
				width: 100%;
				padding-top: 5px;
				padding-bottom: 5px;
				padding-left: 20px;
				padding-right: 20px;
				height: 40px;
			}
			
			
			.power {
			    height: 100px;
			    width: 100%;
			    /*margin-top: 5%;*/
			    position: relative;
			    bottom: 10px;
			}
			
			
			.car-image{
				width: 200px;
				height: 400px;  
				margin-top: -40px; 
				position: absolute; 
				top: 0;
			}
			
			.sport-car{
				width: 100%; 
				height: 100%; 
				position: absolute;
			}
			
			.show-vehicle{
				width: 100%;
				/*height:70%;*/
				/*margin-top: 44px;*/
			}
			
			.show-car-bg{
				
				position: relative;
			}
			
			.tab-bottom-nav{
				width: 100%;
				height: 30%;
				position: absolute;
				bottom: 0;
			}
			
			.mui-bar .mui-icon {
			    font-size: 28px;
			}
			
			.mui-bar-tab .mui-tab-item .mui-icon {
			    top: 32px;
			}
			
			.mui-bar-tab .mui-tab-item .mui-icon~.mui-tab-label {
			    padding-top: 10px;
			    margin-bottom: -10px;
			    font-size: 13px;
			}	
			.mui-title{
				color: floralwhite;
				font-weight: 700;
			}		
		</style>
	</head>

	<body>
		<header id="header" class="mui-bar mui-bar-nav" style="box-shadow: 0 1px 6px  #ccc;"> 
			<a id="vehicle" class="mui-action-menu mui-icon iconfont icon-list mui-pull-left" style="color: #fff"></a>
			<a id="playback" class="mui-icon iconfont icon-xianshiguiji mui-pull-left" style="color: #fff;display: none;"></a>
			<a id="more-set" class="mui-icon iconfont icon-More mui-pull-right" style="color: #fff;"></a>
			<a id="alert" class="mui-icon iconfont icon-baojing mui-pull-right mui-hidden" style="color:#FFFFFF"><span id="alertBadge" class="mui-badge">0</span></a>			
			<h1 id="title" class="mui-title" data-i18n="app.name">车管云</h1>
		</header>
		
		<!--<div style="display: none;">
			<nav class="mui-bar mui-bar-tab" style="display: none;background-color: #080808;" id="nav_bar">
				<a id="default1" class="mui-tab-item mui-active" >
					<span class="mui-icon iconfont icon-write"></span>
					<span class="mui-tab-label" data-i18n="main.home" id="default12">控制</span>
				</a>
				<a id="location" class="mui-tab-item" href="tab-webview-subpage-map.html">
					<span class="mui-icon iconfont icon-weizhiicon"><span id="alertTip" class="mui-badge mui-hidden"></span></span>
					<span class="mui-tab-label" data-i18n="main.monitor">监控</span>
				</a>
				<a id="more" class="mui-tab-item" href="tab-webview-subpage-more.html">
					<span class="mui-icon iconfont icon-More"></span>
					<span class="mui-tab-label" data-i18n="main.more">更多</span>
				</a>
			</nav>
			<div id="iframeHtml">
				<iframe src="tab-webview-subpage-map.html" width="100%" height="100%" id="mapiframe" ></iframe>
			</div>
		</div>-->
		<div id="content" class="mui-content">
			<div class="show-vehicle" id="show-car-image">
				
				<!--<div id="location">
					<a href="tab-webview-subpage-map.html">
						深圳市宝安区留仙三路36号创兴达商务大厦5楼，5012室
					</a>
				</div>-->
				
				<div class="mui-row status1" style="position: relative;z-index: 999;">
					<span class="mui-pull-left">
						<span style="line-height: 20px; margin-left: -9px;"><img class="light" id="gps" src="ui/redStatus.png">GPS</span><br/>
						<span style="line-height: 20px; margin-left: -9px;"><img class="light" id="online" src="ui/redStatus.png">在线</span>
					</span>
					
					<span  id="address" class="title-add" style="color: #FFFFFF;">
						<!--深圳市宝安区留仙三路36号创兴达商务大厦5楼，5012室-->
					</span>
					
					<span class="mui-pull-right" style="line-height: 50px">
						<img class="battery" src="ui/battery.png" style=""><span id='battery'>0.0V</span>
					</span>
				</div>
				
			<!--<div class="mui-row status2">
				<span class="mui-pull-left" style="line-height: 20px">
					<img id="alert" src="ui/alert.png" style="width: 30px; vertical-align: middle; display: none;">
				</span>
				<span class="mui-pull-left" style="line-height: 20px">
					<img id="power" src="ui/cutPower.png" style="width: 30px; vertical-align: middle; display: none;">
				</span>
				<span class="mui-pull-left" style="line-height: 30px">
					<img id="start" src="ui/start.png" style="width: 30px; vertical-align: middle; display: none;">
				</span>				
				&nbsp;
				<span class="mui-pull-right" style="line-height: 20px">
					<img id="door" src="ui/doorOpen.png" style="width: 30px; vertical-align: middle; display: none;">
				</span>				
			</div>			-->
				
				<!--<div class="show-car-bg" style="z-index: 1;">
					<div class="sport-car" style="z-index: 999;">
						<img src="imagecar/sporte_car_close.png" id="show-car-state" class="sport-car" style=" bottom: 40px;"/>
						<img src="imagecar/min_light1.png" id="line1" class="sport-car" style=" z-index: 999; bottom: 40px;" />
					</div>
					<img src="imagecar/sporte_car_show_bg.jpg" class="sport-car" />
				</div>	-->
				
				<div class="show-car-bg" style="z-index: 1;">
					<div style="width: 200px; height: 100%;  margin: 0 auto; position: relative; ">
						<img src="imagecar/car_body.png" style="width: 200px; height: 400px;  margin-top: -40px;"/>
						<img id="front-right-door" src="imagecar/close_door_right_front.png" class="car-image"/>
						<img id="front-left-door" src="imagecar/close_door_left_front.png" class="car-image" />
						<img id="back-right-door" src="imagecar/close_door_right_back.png" class="car-image" />
						<img id="back-left-door" src="imagecar/close_door_left_back.png" class="car-image" />
						<img id="front-right-window" src="imagecar/front_right_window.png" class="car-image" style="display: none;"/>
						<img id="front-left-window" src="imagecar/front_left_window.png" class="car-image" style="display: none;"/>
						<img id="back-right-window" src="imagecar/back_right_window.png" class="car-image" style="display: none;"/>
						<img id="back-left-window" src="imagecar/back_left_window.png" class="car-image" style="display: none;"/>
						<img id="open-behind-light" src="imagecar/open_behind_light2.png" class="car-image" style="display: none;"/>
						<img id="front-behind-blue-light" src="imagecar/open_front_behind.png" class="car-image" style="display: none;" />
					</div>
				</div>
			</div>
		
		<div class="tab-bottom-nav">
			<div class="tab-bottom-nav-lock">
				<img id="start-or-stop" src="imagecar/stop.png" style="position: absolute; z-index: 999;top: 40px;left:157px">
				<div>
					<img id="lock" src="imagecar/lockoff.png" style="height: 90px;float: left">
					<img id="unlock" src="imagecar/unlockoff.png" style="height: 90px;float: left">
				
				</div>
				<div>
					<img id="tail" src="imagecar/tailoff.png" style="height: 90px;float: left">
					<img id="find" src="imagecar/findoff.png" style="height: 90px;float: left">
				</div>
			</div>
		</div>
	
		<script src="./js/mui.min.js"></script>
		<script src="./js/locales.js" ></script>
		<script src="./js/immersed.js" ></script>
		<script src="./js/menu.js" ></script>		
		<script src="js/wistorm/wspub.js"></script>
		<script src="js/wistorm/define.js"></script>
		<script src="js/wistorm/wistorm.js"></script>
		<script src="js/wistorm/md5.js"></script>
		<script src="js/app.js"></script>	
		<!--<script src="js/map.js" type="text/javascript"></script>
		<script src="js/mapjs/define.js" type="text/javascript"></script>-->
		<script src="js/mapjs/global.js" type="text/javascript"></script>
		<script src="js/mapjs/define.js" type="text/javascript"></script>
		<script src="js/mapjs/global.js" type="text/javascript"></script>
		<!--<script type="text/javascript" src="http://ditu.google.cn/maps/api/js?key=AIzaSyAPNfIol28jBmFgzU-ubjI_nVE8fIEtdjg"></script>-->
		<!--<script src="https://maps.googleapis.com/maps/api/js?v=3&key=AIzaSyAPNfIol28jBmFgzU-ubjI_nVE8fIEtdjg"></script>-->
		<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=647127add68dd0a3ed1051fd68e78900"></script>
		<!--<script src="js/mapjs/markerwithlabel.js" type="text/javascript"></script>-->
		<!--<script src="js/mapjs/gomap.js" type="text/javascript"></script>-->		
		<script src="js/mapjs/bmap.js" type="text/javascript"></script>
		<script src="js/mapjs/wisemap.js" type="text/javascript"></script>
		
		<script type="text/javascript" charset="utf-8"> 
			 //mui初始化
			 mui.init();
			 var titleAddress;
			 console.log(window.innerWidth)
			 console.log(window.innerHeight)
			 var _windowWidth = window.innerWidth
			 var _windowHeight = window.innerHeight;
			 var show_car_height = _windowHeight - _windowHeight*0.3 - 44 +'px'
			 var show_car_image = document.getElementById('show-car-image');
//			 var mapiframe = document.getElementById('mapiframe');
			 
			 show_car_image.style.height = show_car_height
//			 mapiframe.style.height = _windowHeight-50+'px';
			 var lock = document.getElementById('lock');
			 var unlock = document.getElementById('unlock');
			 var tail = document.getElementById('tail');
			 var find = document.getElementById('find');
			 var start_or_stop = document.getElementById('start-or-stop');
			 unlock.style.width = _windowWidth/2 + 'px '
			 unlock.style.height = _windowHeight*0.3/2 + 'px';
			 lock.style.height = _windowHeight*0.3/2 + 'px'
			 lock.style.width = _windowWidth/2 +'px';
			 tail.style.height = _windowHeight*0.3/2 + 'px'
			 tail.style.width = _windowWidth/2 + 'px ';
			 find.style.height = _windowHeight*0.3/2 + 'px'
			 find.style.width = _windowWidth/2 +'px';
			 start_or_stop.style.height = _windowHeight*0.3/2+ 10+'px'
			 start_or_stop.style.left = _windowWidth/2 - (_windowHeight*0.3/2 + 10)/2 + 'px'
			 start_or_stop.style.top = _windowHeight*0.3/2-  (_windowHeight*0.3/2 + 10)/2 + 'px';
			 
			var line1 = document.getElementById('open-behind-light');
			 //车灯的闪烁
			var flat = 0;
			var timer;	
 			function changeline (){
 				flat++;
				if(flat <5){
					if(line1.style.display == 'none'){
						line1.style.display = 'block';
					}else {
						line1.style.display = 'none';
					}
				}else {
					flat = 0;
					clearInterval(timer);
				}
//			 	console.log(line1.src.indexOf())
				
//			 	if(line1.src.indexOf('imagecar/open_behind_light2.png') >-1){
////			 		line1.src = ''
//			 	}else {
//			 		line1.src = 'imagecar/open_behind_light2.png'
//			 	}
//			 	console.log(1)
			 }
			 
//			plus.webview.getLaunchWebview().show("pop-in");
			
//			var clearline =  setInterval(changeline,1000)
			
//			var subpages = ['tab-webview-subpage-control.html', 'tab-webview-subpage-map.html', 'tab-webview-subpage-more.html'];
//			alert(immersed);
			
			//创建子页面，首个选项卡页面显示，其它均隐藏；
			mui.plusReady(function() {


				playbackPage = mui.preload({
					"id": 'playback',
					"url": 'playback.html'
				});	
				
				
				
				var backButtonPress = 0;
				mui.back = function(event) {
					console.log(backButtonPress);
					backButtonPress++;
					if (backButtonPress > 1) {
						plus.runtime.quit();
					} else {
						plus.nativeUI.toast("再按一次退出");
					}
					setTimeout(function() {
						backButtonPress = 0;
					}, 1000);
					return false;
				};
			});
			 //当前激活选项
//			var activeTab = subpages[0];
			var title = document.getElementById("title");
			
			 //自定义事件，模拟点击“首页选项卡”
			document.addEventListener('gohome', function() {
				var defaultTab = document.getElementById("location");
				//模拟首页点击
				mui.trigger(defaultTab, 'tap');
				//切换选项卡高亮
				var current = document.querySelector(".mui-bar-tab>.mui-tab-item.mui-active");
				if (defaultTab !== current) {
					current.classList.remove('mui-active');
					defaultTab.classList.add('mui-active');
				}
			});	
//			document.addEventListener('gogps', function() {
//				showPage('tab-webview-subpage-map.html');
//			});	
//			
//			document.addEventListener('gogps', function() {
//				showPage('tab-webview-subpage-map-bak.html');
//			});	
			window.addEventListener('refreshTitle', function(event){
				title.innerHTML = event.detail.name;
				
				console.log("更新详情信息。。。。。。。。。。。。。。。。。"+JSON.stringify(title.innerHTML));
			});	
			
			
			mui.plusReady(function(){
				
				var playbackPage = mui.preload({
					"id": 'playback',
					"url": 'playback.html'
				});	
				
				// 报警列表界面
//				alertPage = mui.preload({
//					"id": 'alert-list-main',
//					"url": 'alert-list-main2.html'
//				});	
				
				baidumap = mui.preload({
					"id":'tab-webview-subpage-badumap',
					"url":'tab-webview-subpage-badumap.html'
				});
				
				var maps = document.getElementById('address');
				maps.addEventListener('tap', function(evet){
					baidumap.show("pop-in");
				});
				
				var more_setpage = mui.preload({
					"id":'tab-webview-subpage-more-set',
					"url":'tab-webview-subpage-more-set.html'
				});
				 
				var more_set = document.getElementById('more-set');
				more_set.addEventListener('tap', function(evet){
					more_setpage.show("pop-in");
				});
			});
				
			
			mui.plusReady(function() {
				var gps = document.getElementById('gps');
				var online = document.getElementById('online');
				var battery = document.getElementById("battery");
				var acc = document.getElementById("start-or-stop");
				var lock = document.getElementById("lock");
				var unlock = document.getElementById('unlock');
				var tail = document.getElementById('tail');
				var findCar = document.getElementById('find');
				var frontRightDoor = document.getElementById('front-right-door');
				var frontLeftDoor = document.getElementById('front-left-door');
				var backRightDoor = document.getElementById('back-right-door');
				var backLeftDoor = document.getElementById('back-left-door');
				var frontBackLinght = document.getElementById('open-behind-light');
				var frontBehindLinght = document.getElementById('front-behind-blue-light');
				var frontRightWindow = document.getElementById('front-right-window');
				var frontLeftWindow = document.getElementById('front-left-window');
				var backRightWindow = document.getElementById('back-right-window');
				var backLeftWindow = document.getElementById('back-left-window');
//				var alert = document.getElementById("alert");
//				var door = document.getElementById("door");
//				var power = document.getElementById('power');
				var showCarState= document.getElementById('show-car-state');
				var lockStatus = false;
				var StandStatus = false;
				var startStatus = false;
				var accStatus = false;
				
//				var getAlertCount = function(){
//					var currentVehicle = app.getCurrentVehicle();
//					if(currentVehicle){
//						app.undealAlert(currentVehicle.did, function(count){
//							console.log('alert count: ' + count);
//							alert.style.display = count > 0 ? 'block': 'none';
//						});
//					}
//				};
				
				var timerAlertCount = function(){
//					getAlertCount();
					setTimeout(function(){
						timerAlertCount();
					}, 10000);
				}
				// 获取报警计数
				timerAlertCount();
				window.addEventListener('refreshAlertBadge', function(event){
					getAlertCount();
				});		
				
				var alertButton = document.getElementById('alert');
				alertButton.addEventListener('tap', function(event) {
					var alertPage = plus.webview.getWebviewById('alert-list-main2');
					mui.fire(alertPage, 'refreshAlertList', null);	
					setTimeout(function(){
						alertPage.show("pop-in");
					}, 200);
				});	
				
				function locationTitle(lon, lat){
					var myGeo = new BMap.Geocoder();     
                                          // 根据坐标得到地址描述   
                    var point = new BMap.Point(lon, lat);
                     	myGeo.getLocation(point, function (result){     
                                if (result){     
                                	address = result.address; 
                                	titleAddress = address;
                                	var baidumaps = document.getElementById('address');
									baidumaps.innerHTML = titleAddress!= '' ? '<span class="mui-icon mui-icon-location">&nbsp;</span>'+titleAddress : '';
//                                  console.log("地理位置=======================" +  titleAddress);
                                   }                                   
                                  });
				}
				
				
				// 位置刷新事件
				
				window.addEventListener('refreshVehicle', function(event) {
					var vehicle = event.detail.vehicle;
//					alert(JSON.stringify(vehicle.params.vstatus.P20C_ENGINE))
					if(vehicle){
						console.log("control did = " + vehicle.did);
						var v = vehicle.activeGpsData;
						    if (v != null) {
                                locationTitle(v.lon, v.lat);
						}
						gps.src = vehicle.activeGpsData.gpsFlag === 2 ? 'ui/greenStatus.png': 'ui/redStatus.png';
						online.src = getOnLine(vehicle) ? 'ui/greenStatus.png': 'ui/redStatus.png';
						battery.innerHTML = (vehicle.activeGpsData.battery||0).toFixed(1) + 'V';
						accStatus = vehicle.activeGpsData.status.indexOf(8196) > -1;
//						accStatus = vehicle.params.vstatus.P20C_ACC;
						acc.src = accStatus ? 'imagecar/start.png':'imagecar/stop.png';
						unlock.src = vehicle.activeGpsData.status.indexOf(IOT_STATUS.STATUS_FORTIFY) > -1 ? 'imagecar/unlockoff.png':'imagecar/unlockon.png';
						lock.src = vehicle.activeGpsData.status.indexOf(IOT_STATUS.STATUS_FORTIFY) > -1 ? 'imagecar/lockon.png':'imagecar/lockoff.png';
						//赛车
//						showCarState.src = vehicle.activeGpsData.status.indexOf(IOT_STATUS.STATUS_FORTIFY) > -1 ? 'imagecar/sporte_car_close.png':'imagecar/sporte_car_open.png';
//						showCarState.src = vehicle.activeGpsData.status.indexOf(IOT_STATUS.STATUS_FORTIFY) > -1 ? 'imagecar/sporte_car_open.png':'imagecar/sporte_car_close.png';
//						console.log('acc src:' + acc.src);
							if(vehicle.params.vstatus){
									frontRightDoorState = vehicle.params.vstatus.P20C_RIGHT_FRONT_DOOR;
									frontLeftDoorState = vehicle.params.vstatus.P20C_LEFT_FRONT_DOOR;
									backRightDoorState = vehicle.params.vstatus.P20C_RIGHT_BACK_DOOR;
									backLeftDoorState = vehicle.params.vstatus.P20C_LEFT_BACK_DOOR;
									frontRightWindowState = vehicle.params.vstatus.P20C_RIGHT_FRONT_WIN;
									frontLeftWindowState = vehicle.params.vstatus.P20C_LEFT_FRONT_WIN;
									backRightWindowState = vehicle.params.vstatus.P20C_RIGHT_BACK_WIN;
									backLeftWindowState = vehicle.params.vstatus.P20C_LEFT_BACK_WIN;
									tailState = vehicle.params.vstatus.P20C_TRUNK;
									frontRightDoor.src = frontRightDoorState ? 'imagecar/open_door_right_front.png':'imagecar/close_door_right_front.png';
									frontLeftDoor.src = frontLeftDoorState ? 'imagecar/open_door_left_front.png':'imagecar/close_door_left_front.png';
									backRightDoor.src = backRightDoorState ? 'imagecar/open_door_right_back.png':'imagecar/close_door_right_back.png';
									backLeftDoor.src = backLeftDoorState ? 'imagecar/open_door_left_back.png':'imagecar/close_door_left_back.png';
									tail.src = tailState ? 'imagecar/tailon.png':'imagecar/tailoff.png';
									frontBehindLinght.style.display = vehicle.params.vstatus.P20C_LITTLE_LAMP == true ? 'block':'none';
							}
								
//						if(frontRightDoorState == false && frontRightWindowState == false){
//							frontRightDoor.src = 'imagecar/front_right_window.png';
//						}
//						else if(frontRightDoorState == true && frontRightWindowState == false){
//							frontRightDoor.src = 'imagecar/open_door_right_front.png';
//						}else if(frontRightDoorState == true && frontRightWindowState == true){
//							frontRightDoor.src = 'imagecar/open_door_right_front.png';
//						}else if(frontRightDoorState ==false && frontRightWindowState == true){
//							frontRightDoor.src = 'imagecar/close_door_right_front.png';
//						}
//						
//						if(frontLeftDoorState == false && frontLeftWindowState == false){
//							frontLeftDoor.src = 'imagecar/front_left_window.png';
//						}
//						else if(frontLeftDoorState ==true && frontLeftWindowState == false){
//							frontLeftDoor.src = 'imagecar/open_door_left_front.png';
//						}else if(frontLeftDoorState == true && frontLeftWindowState == true){
//							frontLeftDoor.src = 'imagecar/open_door_left_front.png';
//						}else if(frontLeftDoorState == false && frontLeftWindowState == true){
//							frontLeftDoor.src = 'imagecar/close_door_left_front.png';
//						}
//						
//						if(backRightDoorState == false && backRightWindowState == false){
//							backRightDoor.src = 'imagecar/back_right_window.png';
//						}
//						else if(backRightDoorState ==true && backRightWindowState == false){
//							backRightDoor.src = 'imagecar/open_door_right_back.png';
//						}else if(backRightDoorState ==true && backRightWindowState == true){
//							backRightDoor.src = 'imagecar/open_door_right_back.png';
//						}else if(backRightDoorState == false && backRightWindowState == true){
//							backRightDoor.src = 'imagecar/close_door_right_back.png';
//						}
//						
//						if(backLeftDoorState == false && backLeftWindowState == false){
//							backLeftDoor.src = 'imagecar/back_left_window.png';
//						}
//						else if(backLeftDoorState == true && backLeftWindowState == false){
//							backLeftDoor.src = 'imagecar/open_door_left_back.png';
//						}else if(backLeftDoorState == true && backLeftWindowState == true){
//							backLeftDoor.src = 'imagecar/open_door_left_back.png';
//						}else if(backLeftDoorState ==false && backLeftWindowState == true){
//							backLeftDoor.src = 'imagecar/close_door_left_back.png';
//						}
						
						lockStatus = vehicle.activeGpsData.status.indexOf(IOT_STATUS.STATUS_LOCK) > -1;
						StandStatus = vehicle.activeGpsData.status.indexOf(IOT_STATUS.STATUS_FORTIFY) > -1;
						
//						if(StandStatus){
//							clearInterval(timer);
//							if(flat == 5){
//								clearInterval(timer);
//								flat = 0;
//							}else {
//								clearInterval(timer);
//								timer = setInterval(changeline,300,timer);
//							}
//						}else {
//							clearInterval(timer);
//							if(flat == 2){
//								clearInterval(timer);
//								flat = 0;
//								}else{
//									timer = setInterval(changeline,300,timer);
//								}
//						}
//							
//						power.style.display = lockStatus ? 'block': 'none';
//						lockStatus?changeline ():line1.src = 'imagecar/min_light1.png'
//						alert.style.display = vehicle.activeGpsData.alerts && vehicle.activeGpsData.alerts.length > 0 ? 'block': 'none';
//						door.style.display = vehicle.activeGpsData.status.indexOf(8212) > -1 ? 'block': 'none';
						startStatus = vehicle.activeGpsData.status.indexOf(IOT_STATUS.STATUS_REMOTE_START) > -1;
//						start.style.display = startStatus ? 'block': 'none';
//						acc.src = startStatus ? 'imagecar/start.png':'imagecar/stop.png';
//						if(startStatus){
//							clearInterval(timer);
//							timer = setInterval(changeline,1000);
//						}else {
//							clearInterval(timer);
//							line1.src = 'imagecar/min_light1.png';
//							
//						}
//						console.log('acc src:' + door.src);
					}else{
						var did = event.detail.did;
						var v ;
						app.getDevice(did, function(vehicle){
							if(vehicle){
//									alert(JSON.stringify(vehicle.params.vstatus.P20C_ENGINE))
									v = vehicle.activeGpsData;
									if (v != null) {
                                		locationTitle(v.lon, v.lat);
                              		}	
								gps.src = vehicle.activeGpsData.gpsFlag === 2 ? 'ui/greenStatus.png': 'ui/redStatus.png';
								online.src = getOnLine(vehicle) ? 'ui/greenStatus.png': 'ui/redStatus.png';
								battery.innerHTML = (vehicle.activeGpsData.battery||0).toFixed(1) + 'V';
//								acc.src = vehicle.activeGpsData.status.indexOf(8196) > -1 ? 'images/flameOut.png':'images/flameOutOff.png';
								accStatus = vehicle.activeGpsData.status.indexOf(8196) > -1;
//								accStatus = vehicle.params.vstatus.P20C_ACC;
								acc.src = accStatus ? 'imagecar/start.png':'imagecar/stop.png';
								unlock.src = vehicle.activeGpsData.status.indexOf(IOT_STATUS.STATUS_FORTIFY) > -1 ? 'imagecar/unlockoff.png':'imagecar/unlockon.png';
								lock.src = vehicle.activeGpsData.status.indexOf(IOT_STATUS.STATUS_FORTIFY) > -1 ? 'imagecar/lockon.png':'imagecar/lockoff.png';
//								showCarState.src = vehicle.activeGpsData.status.indexOf(IOT_STATUS.STATUS_FORTIFY) > -1 ? 'imagecar/sporte_car_close.png':'imagecar/sporte_car_open.png';
//								showCarState.src = vehicle.activeGpsData.status.indexOf(IOT_STATUS.STATUS_FORTIFY) > -1 ? 'imagecar/sporte_car_open.png':'imagecar/sporte_car_close.png';
//								console.log('acc src:' + acc.src);
								lockStatus = vehicle.activeGpsData.status.indexOf(IOT_STATUS.STATUS_LOCK) > -1;
								StandStatus = vehicle.activeGpsData.status.indexOf(IOT_STATUS.STATUS_FORTIFY) > -1;
//								alert.style.display = vehicle.activeGpsData.alerts && vehicle.activeGpsData.alerts.length > 0 ? 'block': 'none';
//								power.style.display = lockStatus ? 'block': 'none';
//								lockStatus?changeline ():line1.src = 'imagecar/min_light1.png';
								
//								door.style.display = vehicle.activeGpsData.status.indexOf(8212) > -1 ? 'block': 'none';
								
								if(vehicle.params.vstatus){
									frontRightDoorState = vehicle.params.vstatus.P20C_RIGHT_FRONT_DOOR;
									frontLeftDoorState = vehicle.params.vstatus.P20C_LEFT_FRONT_DOOR;
									backRightDoorState = vehicle.params.vstatus.P20C_RIGHT_BACK_DOOR;
									backLeftDoorState = vehicle.params.vstatus.P20C_LEFT_BACK_DOOR;
									frontRightWindowState = vehicle.params.vstatus.P20C_RIGHT_FRONT_WIN;
									frontLeftWindowState = vehicle.params.vstatus.P20C_LEFT_FRONT_WIN;
									backRightWindowState = vehicle.params.vstatus.P20C_RIGHT_BACK_WIN;
									backLeftWindowState = vehicle.params.vstatus.P20C_LEFT_BACK_WIN;
									tailState = vehicle.params.vstatus.P20C_TRUNK;
									frontRightDoor.src = frontRightDoorState ? 'imagecar/open_door_right_front.png':'imagecar/close_door_right_front.png';
									frontLeftDoor.src = frontLeftDoorState  ? 'imagecar/open_door_left_front.png':'imagecar/close_door_left_front.png';
									backRightDoor.src = backRightDoorState ? 'imagecar/open_door_right_back.png':'imagecar/close_door_right_back.png';
									backLeftDoor.src = backLeftDoorState ? 'imagecar/open_door_left_back.png':'imagecar/close_door_left_back.png';
									tail.src = tailState ? 'imagecar/tailon.png':'imagecar/tailoff.png'
									frontBehindLinght.style.display = vehicle.params.vstatus.P20C_LITTLE_LAMP == true ? 'block':'none';
								}
								
								
								
			
//								if(frontRightDoorState == false && frontRightWindowState == false){
//									frontRightDoor.src = 'imagecar/front_right_window.png';
//								}
		//						else if(frontRightDoorState == true && frontRightWindowState == false){
		//							frontRightDoor.src = 'imagecar/open_door_right_front.png';
		//						}else if(frontRightDoorState == true && frontRightWindowState == true){
		//							frontRightDoor.src = 'imagecar/open_door_right_front.png';
		//						}else if(frontRightDoorState ==false && frontRightWindowState == true){
		//							frontRightDoor.src = 'imagecar/close_door_right_front.png';
		//						}
		//						
//								if(frontLeftDoorState == false && frontLeftWindowState == false){
//									frontLeftDoor.src = 'imagecar/front_left_window.png';
//								}
		//						else if(frontLeftDoorState ==true && frontLeftWindowState == false){
		//							frontLeftDoor.src = 'imagecar/open_door_left_front.png';
		//						}else if(frontLeftDoorState == true && frontLeftWindowState == true){
		//							frontLeftDoor.src = 'imagecar/open_door_left_front.png';
		//						}else if(frontLeftDoorState == false && frontLeftWindowState == true){
		//							frontLeftDoor.src = 'imagecar/close_door_left_front.png';
		//						}
		//						
//								if(backRightDoorState == false && backRightWindowState == false){
//									backRightDoor.src = 'imagecar/back_right_window.png';
//								}
		//						else if(backRightDoorState ==true && backRightWindowState == false){
		//							backRightDoor.src = 'imagecar/open_door_right_back.png';
		//						}else if(backRightDoorState ==true && backRightWindowState == true){
		//							backRightDoor.src = 'imagecar/open_door_right_back.png';
		//						}else if(backRightDoorState == false && backRightWindowState == true){
		//							backRightDoor.src = 'imagecar/close_door_right_back.png';
		//						}
		//						
//								if(backLeftDoorState == false && backLeftWindowState == false){
//									backLeftDoor.src = 'imagecar/back_left_window.png';
//								}
		//						else if(backLeftDoorState == true && backLeftWindowState == false){
		//							backLeftDoor.src = 'imagecar/open_door_left_back.png';
		//						}else if(backLeftDoorState == true && backLeftWindowState == true){
		//							backLeftDoor.src = 'imagecar/open_door_left_back.png';
		//						}else if(backLeftDoorState ==false && backLeftWindowState == true){
		//							backLeftDoor.src = 'imagecar/close_door_left_back.png';
		//						}
								
								startStatus = vehicle.activeGpsData.status.indexOf(IOT_STATUS.STATUS_REMOTE_START) > -1;
//								start.style.display = startStatus ? 'block': 'none';
//								acc.src = startStatus ? 'imagecar/start.png':'imagecar/stop.png';
								
//								if(StandStatus){
////									clearInterval(timer);
////										if(flat == 5){
//											clearInterval(timer);
////											timer = setInterval(changeline,300,timer);
////											flat = 0;
////										}else {
////											clearInterval(timer);
//											timer = setInterval(changeline,300);
////										}
//									}else {
////										if(flat == 2){
//											clearInterval(timer);
////											flat = 0;
////										}else{
//											timer = setInterval(changeline,300);
////										}
//										
//										
////										line1.src = 'imagecar/open_behind_light2.png';
//										
//									}
//							
								
//								if(startStatus){
//									clearInterval(timer);
//									timer = setInterval(changeline,1000);
//								}else {
//									clearInterval(timer);
//									line1.src = 'imagecar/min_light1.png';
//									
//								}
//								console.log('acc src:' + door.src);
							}
						});
					}
				});
				
				var lockButton = document.getElementById('lock');
//				var isLine
				lockButton.addEventListener('tap', function(event) {
					console.log('lock');
					if(StandStatus){
//						return;
					}
					var cmdType = IOT_CMD.VEHICLE_CONTORL;
					var type = 0;
					var remark = '设防';
					var params = {
						'flag': 2,
						'switch': 1
					};
					var currentVehicle = app.getCurrentVehicle();
					if(currentVehicle){
						plus.nativeUI.showWaiting("设防中...");
						app.sendCommand(currentVehicle.did, cmdType, params, type, remark, 5, function(err) {
							if(err) {
								plus.nativeUI.closeWaiting();
								plus.nativeUI.toast(err);
								return;
							}
							plus.nativeUI.closeWaiting();
							plus.nativeUI.toast('设防成功.');
							StandStatus = true;
							unlock.src = 'imagecar/unlockoff.png';
							lock.src = 'imagecar/lockon.png';	
//							showCarState.src = 'imagecar/sporte_car_close.png';
						});
					}else{
						plus.nativeUI.toast('请选择车辆');	
					}
				});	
				
				var unlockButton = document.getElementById('unlock');
				unlockButton.addEventListener('tap', function(event) {
					console.log('unlock');
					if(!StandStatus){
//						return;
					}
					var cmdType = IOT_CMD.VEHICLE_CONTORL;
					var type = 0;
					var remark = '撤防';
					var params = {
						'flag': 2,
						'switch': 0
					};
					
					var currentVehicle = app.getCurrentVehicle();
					if(currentVehicle){
						plus.nativeUI.showWaiting("撤防中...");
						app.sendCommand(currentVehicle.did, cmdType, params, type, remark, 5, function(err) {
							if(err) {
								plus.nativeUI.closeWaiting();
								plus.nativeUI.toast(err);
								return;
							}
							plus.nativeUI.closeWaiting();
							plus.nativeUI.toast('撤防成功.');
							StandStatus = false;
							unlock.src = 'imagecar/unlockon.png';
							lock.src = 'imagecar/lockoff.png';	
//							showCarState.src = 'imagecar/sporte_car_open.png';
						});
					}else{
						plus.nativeUI.toast('请选着车辆');						
					}
				});	
				
				var tailButton = document.getElementById('tail');
				tailButton.addEventListener('tap', function(event){
//					tailButton.src= 'imagecar/tailon.png';
//					setTimeout(function(){
//						tailButton.src= 'imagecar/tailoff.png';
//					},100)
					
					console.log('tail');
					if(!StandStatus){
//						return;
					}
					var cmdType = IOT_CMD.VEHICLE_CONTORL;
					var type = 0;
					var remark = '打开尾箱';
					var params = {
						'flag': 64,
						'switch': 1
					};
					
					var title = '确认开启尾箱';
					var bts=["否","是"];
					
					var currentVehicle = app.getCurrentVehicle();
					if(currentVehicle){
						
						plus.nativeUI.confirm(title ,function(e){
							var i=e.index;
							if(i == 1){
						plus.nativeUI.showWaiting("打开尾箱中...");
						app.sendCommand(currentVehicle.did, cmdType, params, type, remark, 5, function(err) {
							if(err) {
								plus.nativeUI.closeWaiting();
								plus.nativeUI.toast(err);
								return;
							}
							plus.nativeUI.closeWaiting();
							plus.nativeUI.toast('尾箱打开成功.');
							StandStatus = false;
						});
						}
						},currentVehicle.name,bts);
					}else{
						plus.nativeUI.toast('请选着车辆');						
					}
					
				});
				
				var findButton = document.getElementById('find');
				findButton.addEventListener('tap', function(event){
//					findButton.src= 'imagecar/findon.png';
//					setTimeout(function(){
//						findButton.src= 'imagecar/findoff.png';
//					},100)
					
					console.log('find');
					if(!StandStatus){
//						return;
					}
					var cmdType = IOT_CMD.VEHICLE_CONTORL;
					var type = 0;
					var remark = '寻车';
					var params = {
						'flag': 32,
						'switch': 1
					};
					var currentVehicle = app.getCurrentVehicle();
					if(currentVehicle){
						plus.nativeUI.showWaiting("寻车中...");
						app.sendCommand(currentVehicle.did, cmdType, params, type, remark, 5, function(err) {
							if(err) {
								plus.nativeUI.closeWaiting();
								plus.nativeUI.toast(err);
								return;
							}
							plus.nativeUI.closeWaiting();
							plus.nativeUI.toast('寻车成功.');
						});
					}else{
						plus.nativeUI.toast('请选着车辆');						
					}
					
				});
				
				var accButton = document.getElementById('start-or-stop');
				accButton.addEventListener('tap', function(event) {
					if(accStatus && !startStatus){
						plus.nativeUI.toast('车辆启动时不能远程启动.');
						return;
					}
					var cmdType = IOT_CMD.VEHICLE_CONTORL;
					var type = 0;
					var remark = startStatus ?'熄火': '启动';
					var params = {
						'flag': 8,
						'switch': startStatus ? 0: 1
					};
					var waiting = startStatus? '熄火...': '启动...';
					var title = startStatus ? '确认熄火?': '确认启动';
					var msg = startStatus ? '熄火成功.': '启动成功.';
					var bts=["否","是"];
					var currentVehicle = app.getCurrentVehicle();
					if(currentVehicle){
						plus.nativeUI.confirm(title ,function(e){
							var i=e.index;
							if(i == 1){
								plus.nativeUI.showWaiting(waiting);
								app.sendCommand(currentVehicle.did, cmdType, params,type, remark, 5, function(err) {
									if(err) {
										plus.nativeUI.closeWaiting();
										plus.nativeUI.toast(err);
										return;
									}
									plus.nativeUI.closeWaiting();
									plus.nativeUI.toast(msg);
									startStatus = !startStatus;
//									start.style.display = startStatus ? 'block': 'none';
//									accStatus = startStatus;
//									acc.src = accStatus ? 'imagecar/start.png':'imagecar/stop.png';
//									console.log('start src: ' + start.src);
								});
							}
						},currentVehicle.name,bts);
					}else{
						plus.nativeUI.toast('请选择车辆');
					}
				});
				
			});
			
		</script>
	</body>
</html>